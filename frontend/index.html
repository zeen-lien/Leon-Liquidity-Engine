<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leon Liquidity Engine</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg-primary: #000000;
      --bg-secondary: #050505;
      --bg-panel: #0a0a0a;
      --bg-panel-hover: #111111;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --text-muted: #666666;
      --accent-green: #00ff88;
      --accent-cyan: #00d9ff;
      --accent-purple: #8b5cf6;
      --accent-red: #ef4444;
      --accent-orange: #f59e0b;
      --border-color: rgba(255, 255, 255, 0.08);
      --glow-green: rgba(0, 255, 136, 0.3);
      --glow-cyan: rgba(0, 217, 255, 0.3);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
    }

    /* ============ SIDEBAR ============ */
    .sidebar {
      width: 240px;
      background: var(--bg-primary);
      border-right: 1px solid var(--border-color);
      padding: 20px 12px;
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      margin-bottom: 24px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 14px;
      color: #000;
    }

    .logo-text {
      font-size: 15px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-section {
      margin-bottom: 20px;
    }

    .nav-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-btn {
      width: 100%;
      padding: 10px 12px;
      background: transparent;
      border: none;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      text-align: left;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s ease;
      margin-bottom: 2px;
    }

    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
    }

    .nav-btn.active {
      background: rgba(0, 255, 136, 0.1);
      color: var(--accent-green);
    }

    .nav-btn svg { width: 18px; height: 18px; stroke: currentColor; fill: none; }

    .sidebar-footer {
      margin-top: auto;
      padding: 12px;
      font-size: 10px;
      color: var(--text-muted);
      border-top: 1px solid var(--border-color);
    }

    /* ============ MAIN CONTENT ============ */
    .main {
      flex: 1;
      margin-left: 240px;
      padding: 24px;
      min-height: 100vh;
      transition: margin-left 0.3s ease;
    }

    .page { display: none; }
    .page.active { display: block; }

    .page-header {
      margin-bottom: 24px;
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .page-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* ============ CARDS & PANELS ============ */
    .card {
      background: var(--bg-panel);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 9px;
      padding: 3px 8px;
      border-radius: 4px;
      background: rgba(0, 255, 136, 0.15);
      color: var(--accent-green);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge.purple { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }
    .badge.cyan { background: rgba(0, 217, 255, 0.15); color: var(--accent-cyan); }

    /* ============ GRID LAYOUTS ============ */
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }

    /* ============ STAT CARDS ============ */
    .stat-card {
      background: var(--bg-panel);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--accent-green);
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* ============ BUTTONS ============ */
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
      color: #000;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px var(--glow-green);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .btn svg { width: 16px; height: 16px; }

    /* ============ FORM ELEMENTS ============ */
    .form-group { margin-bottom: 16px; }

    .form-label {
      display: block;
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 10px 14px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 13px;
      outline: none;
      transition: border-color 0.2s ease;
    }

    .form-input:focus, .form-select:focus {
      border-color: var(--accent-green);
    }

    .form-select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }

    /* ============ TABLES ============ */
    .table-container {
      overflow-x: auto;
      margin-top: 12px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th, td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    th {
      font-size: 10px;
      text-transform: uppercase;
      color: var(--text-muted);
      font-weight: 600;
    }

    /* ============ PRICE CARDS ============ */
    .price-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
    }

    .price-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .price-symbol {
      font-size: 12px;
      font-weight: 600;
      color: var(--accent-cyan);
    }

    .price-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-green);
    }

    /* ============ PREDICTION CARD ============ */
    .prediction-box {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(0, 217, 255, 0.1));
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .prediction-direction {
      font-size: 48px;
      font-weight: 800;
      margin: 12px 0;
    }

    .prediction-direction.up { color: var(--accent-green); }
    .prediction-direction.down { color: var(--accent-red); }

    /* ============ CHART CONTAINERS ============ */
    .chart-container {
      position: relative;
      height: 200px;
    }

    /* ============ STATUS INDICATORS ============ */
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }

    .status-dot.online { background: var(--accent-green); box-shadow: 0 0 8px var(--accent-green); }
    .status-dot.offline { background: var(--accent-red); }

    /* ============ MOBILE NAV BUTTON ============ */
    .mobile-nav-btn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
      border: none;
      border-radius: 50%;
      color: #000;
      font-size: 24px;
      cursor: pointer;
      z-index: 200;
      box-shadow: 0 4px 20px var(--glow-green);
      transition: transform 0.2s ease;
    }

    .mobile-nav-btn:hover {
      transform: scale(1.1);
    }

    /* ============ OVERLAY ============ */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 90;
    }

    .overlay.active { display: block; }

    /* ============ LOADING ============ */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-muted);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--border-color);
      border-top-color: var(--accent-green);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* ============ RESPONSIVE ============ */
    @media (max-width: 1024px) {
      .grid-4 { grid-template-columns: repeat(2, 1fr); }
      .grid-3 { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 260px;
      }

      .sidebar.open { transform: translateX(0); }

      .main {
        margin-left: 0;
        padding: 16px;
      }

      .mobile-nav-btn { display: flex; align-items: center; justify-content: center; }
      
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
      
      .page-title { font-size: 20px; }
      
      .price-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 480px) {
      .main { padding: 12px; }
      .card { padding: 16px; }
      .stat-value { font-size: 24px; }
    }

    /* ============ SIGNAL COLORS ============ */
    .signal-buy { color: var(--accent-green); }
    .signal-sell { color: var(--accent-red); }
    .signal-hold { color: var(--accent-orange); }

    /* ============ SCROLLBAR ============ */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
  </style>
</head>
<body>
  <!-- Overlay for mobile -->
  <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="logo">
      <div class="logo-icon">LE</div>
      <span class="logo-text">Leon Engine</span>
    </div>

    <nav class="nav-section">
      <div class="nav-label">Live Trading</div>
      <button class="nav-btn active" onclick="showPage('dashboard')">
        <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Dashboard
      </button>
      <button class="nav-btn" onclick="showPage('live-signals')">
        <svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
        Live Signals
      </button>
      <button class="nav-btn" onclick="showPage('ai-prediction')">
        <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        AI Prediction
      </button>
    </nav>

    <nav class="nav-section">
      <div class="nav-label">Backtest & Research</div>
      <button class="nav-btn" onclick="showPage('backtest')">
        <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Backtest (CSV)
      </button>
      <button class="nav-btn" onclick="showPage('data-manager')">
        <svg viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
        Data Manager
      </button>
    </nav>

    <div class="sidebar-footer">
      <div style="display: flex; align-items: center; margin-bottom: 8px;">
        <span class="status-dot online"></span>
        <span>Server Online</span>
      </div>
      <div>Leon Liquidity Engine v2.1</div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">

    <!-- ============ DASHBOARD PAGE ============ -->
    <section class="page active" id="page-dashboard">
      <div class="page-header">
        <h1 class="page-title">Dashboard</h1>
        <p class="page-subtitle">Real-time market overview dan trading signals</p>
      </div>

      <!-- Stats Row -->
      <div class="grid-4" style="margin-bottom: 20px;">
        <div class="stat-card">
          <div class="stat-value" id="stat-total-signals">0</div>
          <div class="stat-label">Total Signals</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color: var(--accent-green);" id="stat-win-rate">0%</div>
          <div class="stat-label">Win Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color: var(--accent-cyan);" id="stat-avg-pnl">0%</div>
          <div class="stat-label">Avg P&L</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" style="color: var(--accent-purple);" id="stat-active-pairs">10</div>
          <div class="stat-label">Active Pairs</div>
        </div>
      </div>

      <!-- Real-time Prices -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
            Real-Time Prices
            <span class="badge">LIVE</span>
          </div>
          <button class="btn btn-secondary" onclick="loadRealtimePrices()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
            Refresh
          </button>
        </div>
        <div class="price-grid" id="realtime-prices">
          <div class="loading"><div class="spinner"></div>Memuat harga...</div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Distribusi Hasil <span class="badge">PIE CHART</span></div>
          </div>
          <div class="chart-container">
            <canvas id="chartPie"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-title">Equity Curve <span class="badge cyan">GROWTH</span></div>
          </div>
          <div class="chart-container">
            <canvas id="chartEquity"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- ============ LIVE SIGNALS PAGE ============ -->
    <section class="page" id="page-live-signals">
      <div class="page-header">
        <h1 class="page-title">Live Signals</h1>
        <p class="page-subtitle">Trading signals real-time dari analisis AI</p>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Generate Signal</div>
        </div>
        <div class="grid-3" style="margin-bottom: 16px;">
          <div class="form-group">
            <label class="form-label">Symbol</label>
            <select class="form-select" id="live-symbol">
              <option value="BTCUSDT">BTC/USDT</option>
              <option value="ETHUSDT">ETH/USDT</option>
              <option value="BNBUSDT">BNB/USDT</option>
              <option value="SOLUSDT">SOL/USDT</option>
              <option value="XRPUSDT">XRP/USDT</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Mode Trading</label>
            <select class="form-select" id="live-mode">
              <option value="aktif">Aktif (1-4H)</option>
              <option value="santai" selected>Santai (4-12H)</option>
              <option value="pasif">Pasif (12-24H)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">&nbsp;</label>
            <button class="btn btn-primary" style="width: 100%;" onclick="generateLiveSignal()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
              Generate Signal
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Latest Signals</div>
        </div>
        <div class="table-container" id="live-signals-table">
          <div class="loading"><div class="spinner"></div>Belum ada signal. Klik Generate untuk memulai.</div>
        </div>
      </div>
    </section>

    <!-- ============ AI PREDICTION PAGE ============ -->
    <section class="page" id="page-ai-prediction">
      <div class="page-header">
        <h1 class="page-title">AI Prediction</h1>
        <p class="page-subtitle">Prediksi arah harga menggunakan LSTM Deep Learning</p>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Select Symbol</div>
          </div>
          <div class="form-group">
            <select class="form-select" id="ai-symbol" style="font-size: 16px; padding: 14px;">
              <option value="BTCUSDT">BTC/USDT - Bitcoin</option>
              <option value="ETHUSDT">ETH/USDT - Ethereum</option>
              <option value="BNBUSDT">BNB/USDT - Binance Coin</option>
              <option value="SOLUSDT">SOL/USDT - Solana</option>
              <option value="XRPUSDT">XRP/USDT - Ripple</option>
              <option value="DOGEUSDT">DOGE/USDT - Dogecoin</option>
              <option value="ADAUSDT">ADA/USDT - Cardano</option>
              <option value="AVAXUSDT">AVAX/USDT - Avalanche</option>
            </select>
          </div>
          <button class="btn btn-primary" style="width: 100%; margin-top: 8px;" onclick="getAIPrediction()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/></svg>
            Get AI Prediction
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Prediction Result <span class="badge purple">LSTM</span></div>
          </div>
          <div id="ai-prediction-result">
            <div class="loading">Pilih symbol dan klik "Get AI Prediction"</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Tentang AI Prediction</div>
        </div>
        <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.7;">
          <p><strong>LSTM (Long Short-Term Memory)</strong> adalah jenis neural network yang sangat baik untuk menganalisis data time-series seperti harga cryptocurrency.</p>
          <br>
          <p>Model ini menganalisis:</p>
          <ul style="margin-left: 20px; margin-top: 8px;">
            <li>Pola harga historis (OHLCV)</li>
            <li>Indikator teknikal (RSI, EMA, ATR)</li>
            <li>Volume dan momentum</li>
          </ul>
          <br>
          <p style="color: var(--accent-orange);">‚ö†Ô∏è Disclaimer: Prediksi AI bukan jaminan profit. Selalu gunakan risk management yang baik.</p>
        </div>
      </div>
    </section>

    <!-- ============ BACKTEST PAGE ============ -->
    <section class="page" id="page-backtest">
      <div class="page-header">
        <h1 class="page-title">Backtest (CSV)</h1>
        <p class="page-subtitle">Test strategi trading dengan data historis</p>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Generate Backtest Signal</div>
          </div>
          <div class="form-group">
            <label class="form-label">Pilih Folder Data</label>
            <select class="form-select" id="backtest-folder">
              <option value="">-- Pilih Folder --</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Mode Trading</label>
            <select class="form-select" id="backtest-mode">
              <option value="aktif">Aktif - RSI 6, EMA 9/20/50</option>
              <option value="santai" selected>Santai - RSI 8, EMA 20/50/200</option>
              <option value="pasif">Pasif - RSI 14, EMA 50/100/200</option>
            </select>
          </div>
          <button class="btn btn-primary" style="width: 100%;" onclick="runBacktest()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            Run Backtest
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Backtest Statistics</div>
          </div>
          <div id="backtest-stats">
            <div class="grid-2" style="gap: 12px;">
              <div class="stat-card">
                <div class="stat-value" id="bt-total">0</div>
                <div class="stat-label">Total Signals</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" style="color: var(--accent-green);" id="bt-winrate">0%</div>
                <div class="stat-label">Win Rate</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" style="color: var(--accent-green);" id="bt-tp">0</div>
                <div class="stat-label">HIT TP</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" style="color: var(--accent-red);" id="bt-sl">0</div>
                <div class="stat-label">HIT SL</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Backtest Results</div>
        </div>
        <div class="table-container" id="backtest-results">
          <div class="loading">Pilih folder dan klik "Run Backtest" untuk memulai</div>
        </div>
      </div>
    </section>

    <!-- ============ DATA MANAGER PAGE ============ -->
    <section class="page" id="page-data-manager">
      <div class="page-header">
        <h1 class="page-title">Data Manager</h1>
        <p class="page-subtitle">Upload dan kelola data CSV untuk backtest</p>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Upload CSV</div>
          </div>
          <div class="form-group">
            <label class="form-label">Pilih Folder Tujuan</label>
            <div style="display: flex; gap: 8px;">
              <select class="form-select" id="upload-folder" style="flex: 1;">
                <option value="">-- Pilih Folder --</option>
              </select>
              <button class="btn btn-secondary" onclick="createFolder()">+ Folder</button>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">File CSV</label>
            <input type="file" class="form-input" id="upload-file" accept=".csv" />
          </div>
          <button class="btn btn-primary" style="width: 100%;" onclick="uploadCSV()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            Upload
          </button>
          <div id="upload-status" style="margin-top: 12px; font-size: 12px;"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Pra-Proses Data</div>
          </div>
          <div class="form-group">
            <label class="form-label">Pilih Folder untuk Diproses</label>
            <select class="form-select" id="process-folder">
              <option value="">-- Pilih Folder --</option>
            </select>
          </div>
          <button class="btn btn-primary" style="width: 100%;" onclick="processData()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            Proses Indikator
          </button>
          <div id="process-status" style="margin-top: 12px; font-size: 12px;"></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Daftar Folder</div>
          <button class="btn btn-secondary" onclick="loadFolders()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/></svg>
            Refresh
          </button>
        </div>
        <div id="folder-list">
          <div class="loading"><div class="spinner"></div>Memuat folder...</div>
        </div>
      </div>
    </section>
  </main>

  <!-- Mobile Nav Button -->
  <button class="mobile-nav-btn" onclick="toggleSidebar()">‚ò∞</button>
select>label></div>div>div></div>div>div></div>""


  <script>
    // ============ NAVIGATION ============
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      
      const page = document.getElementById('page-' + pageId);
      if (page) page.classList.add('active');
      
      event.target.closest('.nav-btn')?.classList.add('active');
      
      // Close sidebar on mobile
      if (window.innerWidth <= 768) {
        document.getElementById('sidebar').classList.remove('open');
        document.getElementById('overlay').classList.remove('active');
      }
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('overlay').classList.toggle('active');
    }

    // ============ REAL-TIME PRICES ============
    async function loadRealtimePrices() {
      const container = document.getElementById('realtime-prices');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>Memuat harga...</div>';
      
      try {
        const res = await fetch('/binance/prices');
        const data = await res.json();
        
        if (data.status === 'sukses' && data.data) {
          let html = '';
          data.data.forEach(item => {
            const symbol = item.symbol.replace('USDT', '');
            const price = parseFloat(item.price);
            const formatted = price >= 1 ? price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : price.toFixed(6);
            html += `<div class="price-card"><span class="price-symbol">${symbol}</span><span class="price-value">$${formatted}</span></div>`;
          });
          container.innerHTML = html;
        }
      } catch (err) {
        container.innerHTML = `<div style="color: var(--accent-red); padding: 20px;">Error: ${err.message}</div>`;
      }
    }

    // ============ AI PREDICTION ============
    async function getAIPrediction() {
      const symbol = document.getElementById('ai-symbol').value;
      const container = document.getElementById('ai-prediction-result');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>Menganalisis...</div>';
      
      try {
        const res = await fetch(`/lstm/predict/${symbol}`);
        const data = await res.json();
        
        if (data.status === 'sukses' && data.prediksi) {
          const pred = data.prediksi;
          const dir = pred.direction;
          const conf = (pred.confidence * 100).toFixed(0);
          const price = data.harga_terkini ? parseFloat(data.harga_terkini).toLocaleString('en-US', {minimumFractionDigits: 2}) : '-';
          
          const dirClass = dir === 'UP' ? 'up' : 'down';
          const dirIcon = dir === 'UP' ? '‚Üë' : dir === 'DOWN' ? '‚Üì' : '‚Üí';
          const dirText = dir === 'UP' ? 'NAIK' : dir === 'DOWN' ? 'TURUN' : 'NETRAL';
          const rekom = data.rekomendasi?.aksi || (dir === 'UP' ? 'BELI' : dir === 'DOWN' ? 'JUAL' : 'TUNGGU');
          
          container.innerHTML = `
            <div class="prediction-box">
              <div style="font-size: 12px; color: var(--text-muted);">${symbol.replace('USDT', '/USDT')}</div>
              <div class="prediction-direction ${dirClass}">${dirIcon}</div>
              <div style="font-size: 18px; font-weight: 700; color: ${dir === 'UP' ? 'var(--accent-green)' : 'var(--accent-red)'};">${dirText}</div>
              <div style="margin-top: 12px; font-size: 13px;">Confidence: <strong>${conf}%</strong></div>
              <div style="margin-top: 8px; font-size: 13px;">Harga: <strong>$${price}</strong></div>
              ${pred.rsi ? `<div style="margin-top: 8px; font-size: 11px; color: var(--text-secondary);">RSI: ${pred.rsi} | EMA20: ${pred.ema_20} | EMA50: ${pred.ema_50}</div>` : ''}
              <div style="margin-top: 16px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                <div style="font-size: 11px; color: var(--text-muted);">Rekomendasi</div>
                <div style="font-size: 18px; font-weight: 700; color: ${rekom === 'BELI' ? 'var(--accent-green)' : rekom === 'JUAL' ? 'var(--accent-red)' : 'var(--accent-orange)'};">${rekom}</div>
                ${data.rekomendasi?.alasan ? `<div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">${data.rekomendasi.alasan}</div>` : ''}
              </div>
            </div>
          `;
        }
      } catch (err) {
        container.innerHTML = `<div style="color: var(--accent-red); padding: 20px;">Error: ${err.message}</div>`;
      }
    }

    // ============ LIVE SIGNALS ============
    async function generateLiveSignal() {
      const symbol = document.getElementById('live-symbol').value;
      const mode = document.getElementById('live-mode').value;
      const container = document.getElementById('live-signals-table');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>Generating signal...</div>';
      
      try {
        // Get real-time data and analyze
        const res = await fetch(`/binance/analyze/${symbol}?mode_trading=${mode}`, { method: 'POST' });
        const data = await res.json();
        
        if (data.status === 'sukses') {
          // Show current indicators
          let html = `
            <div style="margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;">
              <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">Indikator Terkini - ${symbol}</div>
              <div style="display: flex; gap: 12px; flex-wrap: wrap; font-size: 11px;">
                <span>RSI: <strong style="color: var(--accent-cyan);">${data.indikator_terkini?.rsi_14 || '-'}</strong></span>
                <span>EMA20: <strong>${data.indikator_terkini?.ema_20 || '-'}</strong></span>
                <span>EMA50: <strong>${data.indikator_terkini?.ema_50 || '-'}</strong></span>
                <span>Harga: <strong style="color: var(--accent-green);">$${data.harga_terkini?.toLocaleString() || '-'}</strong></span>
              </div>
            </div>
          `;
          
          if (data.sinyal && data.sinyal.length > 0) {
            html += '<table><thead><tr><th>Pair</th><th>Signal</th><th>Entry</th><th>SL</th><th>TP</th><th>Confidence</th><th>Alasan</th></tr></thead><tbody>';
            data.sinyal.forEach(s => {
              html += `<tr>
                <td><strong>${s.pair || symbol}</strong></td>
                <td class="${s.tipe === 'BELI' ? 'signal-buy' : 'signal-sell'}"><strong>${s.tipe}</strong></td>
                <td>$${s.entry?.toFixed(2) || '-'}</td>
                <td>$${s.stop_loss?.toFixed(2) || '-'}</td>
                <td>$${s.take_profit?.toFixed(2) || '-'}</td>
                <td>${s.confidence ? (s.confidence * 100).toFixed(0) + '%' : '-'}</td>
                <td style="font-size: 11px;">${s.alasan || '-'}</td>
              </tr>`;
            });
            html += '</tbody></table>';
          } else {
            html += '<div style="padding: 20px; color: var(--text-muted); text-align: center;">Tidak ada signal yang memenuhi kriteria saat ini. Coba mode trading lain atau tunggu kondisi market yang lebih baik.</div>';
          }
          container.innerHTML = html;
        } else {
          container.innerHTML = '<div style="padding: 20px; color: var(--text-muted);">Tidak ada signal yang memenuhi kriteria saat ini.</div>';
        }
      } catch (err) {
        container.innerHTML = `<div style="color: var(--accent-red); padding: 20px;">Error: ${err.message}</div>`;
      }
    }

    // ============ BACKTEST ============
    async function runBacktest() {
      const folder = document.getElementById('backtest-folder').value;
      const mode = document.getElementById('backtest-mode').value;
      
      if (!folder) {
        alert('Pilih folder terlebih dahulu!');
        return;
      }
      
      const container = document.getElementById('backtest-results');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>Running backtest...</div>';
      
      try {
        const res = await fetch('/sinyal/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ folder, mode_trading: mode, confidence_minimum: 0.60 })
        });
        
        const data = await res.json();
        
        // Update stats
        if (data.backtest_statistics) {
          const stats = data.backtest_statistics;
          document.getElementById('bt-total').textContent = stats.total_signals || 0;
          document.getElementById('bt-winrate').textContent = (stats.win_rate || 0) + '%';
          document.getElementById('bt-tp').textContent = stats.hit_tp || 0;
          document.getElementById('bt-sl').textContent = stats.hit_sl || 0;
        }
        
        // Show signals
        if (data.sinyal && data.sinyal.length > 0) {
          let html = '<table><thead><tr><th>Pair</th><th>Tipe</th><th>Entry</th><th>SL</th><th>TP</th><th>Conf</th><th>Result</th><th>P&L</th></tr></thead><tbody>';
          data.sinyal.forEach(s => {
            const resultColor = s.backtest_result === 'HIT_TP' ? 'var(--accent-green)' : s.backtest_result === 'HIT_SL' ? 'var(--accent-red)' : 'var(--text-muted)';
            const pnl = s.pnl_percent || 0;
            const pnlColor = pnl > 0 ? 'var(--accent-green)' : pnl < 0 ? 'var(--accent-red)' : 'var(--text-muted)';
            html += `<tr>
              <td>${s.pair || '-'}</td>
              <td class="${s.tipe === 'BELI' ? 'signal-buy' : 'signal-sell'}"><strong>${s.tipe}</strong></td>
              <td>${s.entry?.toFixed(4) || '-'}</td>
              <td>${s.stop_loss?.toFixed(4) || '-'}</td>
              <td>${s.take_profit?.toFixed(4) || '-'}</td>
              <td>${(s.confidence * 100).toFixed(0)}%</td>
              <td style="color: ${resultColor};"><strong>${s.backtest_result || '-'}</strong></td>
              <td style="color: ${pnlColor};">${pnl > 0 ? '+' : ''}${pnl.toFixed(2)}%</td>
            </tr>`;
          });
          html += '</tbody></table>';
          container.innerHTML = html;
        } else {
          container.innerHTML = '<div style="padding: 20px; color: var(--text-muted);">Tidak ada signal yang ditemukan.</div>';
        }
      } catch (err) {
        container.innerHTML = `<div style="color: var(--accent-red); padding: 20px;">Error: ${err.message}</div>`;
      }
    }

    // ============ DATA MANAGER ============
    async function loadFolders() {
      try {
        const res = await fetch('/folder/daftar');
        const data = await res.json();
        
        const folders = data.folder || [];
        
        // Update all folder selects
        const selects = ['upload-folder', 'process-folder', 'backtest-folder'];
        selects.forEach(id => {
          const select = document.getElementById(id);
          if (select) {
            select.innerHTML = '<option value="">-- Pilih Folder --</option>';
            folders.forEach(f => {
              select.innerHTML += `<option value="${f}">${f}</option>`;
            });
          }
        });
        
        // Update folder list
        const listContainer = document.getElementById('folder-list');
        if (folders.length > 0) {
          let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">';
          folders.forEach(f => {
            html += `<div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; margin-bottom: 4px;">üìÅ</div>
              <div style="font-size: 13px; font-weight: 600;">${f}</div>
            </div>`;
          });
          html += '</div>';
          listContainer.innerHTML = html;
        } else {
          listContainer.innerHTML = '<div style="padding: 20px; color: var(--text-muted); text-align: center;">Belum ada folder. Buat folder baru untuk memulai.</div>';
        }
      } catch (err) {
        console.error('Error loading folders:', err);
      }
    }

    async function createFolder() {
      const name = prompt('Nama folder baru (contoh: BTC, ETH):');
      if (!name) return;
      
      try {
        const res = await fetch('/folder/buat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nama_folder: name })
        });
        
        if (res.ok) {
          loadFolders();
          alert('Folder berhasil dibuat!');
        } else {
          const err = await res.text();
          alert('Error: ' + err);
        }
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    async function uploadCSV() {
      const folder = document.getElementById('upload-folder').value;
      const fileInput = document.getElementById('upload-file');
      const status = document.getElementById('upload-status');
      
      if (!folder) {
        status.innerHTML = '<span style="color: var(--accent-red);">Pilih folder terlebih dahulu!</span>';
        return;
      }
      
      if (!fileInput.files[0]) {
        status.innerHTML = '<span style="color: var(--accent-red);">Pilih file CSV!</span>';
        return;
      }
      
      const formData = new FormData();
      formData.append('berkas', fileInput.files[0]);
      
      status.innerHTML = '<span style="color: var(--accent-cyan);">Uploading...</span>';
      
      try {
        const res = await fetch(`/unggah-csv/?folder=${encodeURIComponent(folder)}`, {
          method: 'POST',
          body: formData
        });
        
        if (res.ok) {
          const data = await res.json();
          status.innerHTML = `<span style="color: var(--accent-green);">‚úì Upload berhasil! ${data.jumlah_baris} baris data.</span>`;
          fileInput.value = '';
        } else {
          const err = await res.text();
          status.innerHTML = `<span style="color: var(--accent-red);">Error: ${err}</span>`;
        }
      } catch (err) {
        status.innerHTML = `<span style="color: var(--accent-red);">Error: ${err.message}</span>`;
      }
    }

    async function processData() {
      const folder = document.getElementById('process-folder').value;
      const status = document.getElementById('process-status');
      
      if (!folder) {
        status.innerHTML = '<span style="color: var(--accent-red);">Pilih folder terlebih dahulu!</span>';
        return;
      }
      
      status.innerHTML = '<span style="color: var(--accent-cyan);">Processing...</span>';
      
      try {
        const res = await fetch('/pra-proses/indikator/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ folder })
        });
        
        if (res.ok) {
          const data = await res.json();
          status.innerHTML = `<span style="color: var(--accent-green);">‚úì Berhasil memproses ${data.jumlah_berkas} file!</span>`;
        } else {
          const err = await res.text();
          status.innerHTML = `<span style="color: var(--accent-red);">Error: ${err}</span>`;
        }
      } catch (err) {
        status.innerHTML = `<span style="color: var(--accent-red);">Error: ${err.message}</span>`;
      }
    }

    // ============ CHARTS ============
    let chartPie = null;
    let chartEquity = null;

    function initCharts() {
      // Pie Chart
      const ctxPie = document.getElementById('chartPie');
      if (ctxPie) {
        chartPie = new Chart(ctxPie, {
          type: 'doughnut',
          data: {
            labels: ['HIT TP', 'HIT SL', 'TIMEOUT'],
            datasets: [{
              data: [65, 25, 10],
              backgroundColor: ['rgba(0, 255, 136, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(102, 102, 102, 0.8)'],
              borderWidth: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom', labels: { color: '#b0b0b0', font: { size: 11 } } } }
          }
        });
      }

      // Equity Chart
      const ctxEquity = document.getElementById('chartEquity');
      if (ctxEquity) {
        const labels = ['Start', 'T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10'];
        const data = [10000, 10250, 10100, 10400, 10350, 10600, 10550, 10800, 11000, 10900, 11200];
        
        chartEquity = new Chart(ctxEquity, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Equity',
              data: data,
              borderColor: 'rgba(0, 255, 136, 1)',
              backgroundColor: 'rgba(0, 255, 136, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#666', font: { size: 10 } } },
              y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#666', font: { size: 10 } } }
            }
          }
        });
      }
    }

    // ============ INIT ============
    document.addEventListener('DOMContentLoaded', () => {
      loadRealtimePrices();
      loadFolders();
      initCharts();
      
      // Update stats from localStorage if available
      const stats = JSON.parse(localStorage.getItem('backtestStatistics') || '{}');
      if (stats.total_signals) {
        document.getElementById('stat-total-signals').textContent = stats.total_signals;
        document.getElementById('stat-win-rate').textContent = stats.win_rate + '%';
        document.getElementById('stat-avg-pnl').textContent = (stats.avg_pnl > 0 ? '+' : '') + stats.avg_pnl + '%';
      }
    });
  </script>
</body>
</html>
